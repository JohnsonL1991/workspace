(function(a){var b=["\u5317\u4EAC|beijing|bj","\u4E0A\u6D77|shanghai|sh","\u91CD\u5E86|chongqing|cq","\u6DF1\u5733|shenzhen|sz","\u5E7F\u5DDE|guangzhou|gz","\u676D\u5DDE|hangzhou|hz","\u5357\u4EAC|nanjing|nj","\u82CF\u5DDE|shuzhou|sz","\u5929\u6D25|tianjin|tj","\u6210\u90FD|chengdu|cd","\u5357\u660C|nanchang|nc","\u4E09\u4E9A|sanya|sy","\u9752\u5C9B|qingdao|qd","\u53A6\u95E8|xiamen|xm","\u897F\u5B89|xian|xa","\u957F\u6C99|changsha|cs","\u5408\u80A5|hefei|hf","\u897F\u85CF|xizang|xz","\u5185\u8499\u53E4|neimenggu|nmg","\u5B89\u5E86|anqing|aq","\u963F\u6CF0\u52D2|ataile|atl","\u5B89\u5EB7|ankang|ak","\u963F\u514B\u82CF|akesu|aks","\u5305\u5934|baotou|bt","\u5317\u6D77|beihai|bh","\u767E\u8272|baise|bs","\u4FDD\u5C71|baoshan|bs","\u957F\u6CBB|changzhi|cz","\u957F\u6625|changchun|cc","\u5E38\u5DDE|changzhou|cz","\u660C\u90FD|changdu|cd","\u671D\u9633|chaoyang|cy","\u5E38\u5FB7|changde|cd","\u957F\u767D\u5C71|changbaishan|cbs","\u8D64\u5CF0|chifeng|cf","\u5927\u540C|datong|dt","\u5927\u8FDE|dalian|dl","\u8FBE\u53BF|daxian|dx","\u4E1C\u8425|dongying|dy","\u5927\u5E86|daqing|dq","\u4E39\u4E1C|dandong|dd","\u5927\u7406|dali|dl","\u6566\u714C|dunhuang|dh","\u9102\u5C14\u591A\u65AF|eerduosi|eeds","\u6069\u65BD|enshi|es","\u798F\u5DDE|fuzhou|fz","\u961C\u9633|fuyang|fy","\u8D35\u9633|guiyang|gy","\u6842\u6797|guilin|gl","\u5E7F\u5143|guangyuan|gy","\u683C\u5C14\u6728|geermu|gem","\u547C\u548C\u6D69\u7279|huhehaote|hhht","\u54C8\u5BC6|hami|hm","\u9ED1\u6CB3|heihe|hh","\u6D77\u62C9\u5C14|hailaer|hle","\u54C8\u5C14\u6EE8|haerbin|heb","\u6D77\u53E3|haikou|hk","\u9EC4\u5C71|huangshan|hs","\u90AF\u90F8|handan|hd","\u6C49\u4E2D|hanzhong|hz","\u548C\u7530|hetian|ht","\u664B\u6C5F|jinjiang|jj","\u9526\u5DDE|jinzhou|jz","\u666F\u5FB7\u9547|jingdezhen|jdz","\u5609\u5CEA\u5173|jiayuguan|jyg","\u4E95\u5188\u5C71|jinggangshan|jgs","\u6D4E\u5B81|jining|jn","\u4E5D\u6C5F|jiujiang|jj","\u4F73\u6728\u65AF|jiamusi|jms","\u6D4E\u5357|jinan|jn","\u5580\u4EC0|kashi|ks","\u6606\u660E|kunming|km","\u5EB7\u5B9A|kangding|kd","\u514B\u62C9\u739B\u4F9D|kelamayi|klmy","\u5E93\u5C14\u52D2|kuerle|kel","\u5E93\u8F66|kuche|kc","\u5170\u5DDE|lanzhou|lz","\u6D1B\u9633|luoyang|ly","\u4E3D\u6C5F|lijiang|lj","\u6797\u829D|linzhi|lz","\u67F3\u5DDE|liuzhou|lz","\u6CF8\u5DDE|luzhou|lz","\u8FDE\u4E91\u6E2F|lianyungang|lyg","\u9ECE\u5E73|liping|lp","\u8FDE\u6210|liancheng|lc","\u62C9\u8428|lasa|ls","\u4E34\u6CA7|lincang|lc","\u4E34\u6C82|linyi|ly","\u8292\u5E02|mangshi|ms","\u7261\u4E39\u6C5F|mudanjiang|mdj","\u6EE1\u6D32\u91CC|manzhouli|mzl","\u7EF5\u9633|mianyang|my","\u6885\u53BF|meixian|mx","\u6F20\u6CB3|mohe|mh","\u5357\u5145|nanchong|nc","\u5357\u5B81|nanning|nn","\u5357\u9633|nanyang|ny","\u5357\u901A|nantong|nt","\u90A3\u62C9\u63D0|nalati|nlt","\u5B81\u6CE2|ningbo|nb","\u6500\u679D\u82B1|panzhihua|pzh","\u8862\u5DDE|quzhou|qz","\u79E6\u7687\u5C9B|qinhuangdao|qhd","\u5E86\u9633|qingyang|qy","\u9F50\u9F50\u54C8\u5C14|qiqihaer|qqhe","\u77F3\u5BB6\u5E84|shijiazhuang|sjz","\u6C88\u9633|shenyang|sy","\u601D\u8305|simao|sm","\u94DC\u4EC1|tongren|tr","\u5854\u57CE|tacheng|tc","\u817E\u51B2|tengchong|tc","\u53F0\u5DDE|taizhou|tz","\u901A\u8FBD|tongliao|tl","\u592A\u539F|taiyuan|ty","\u5A01\u6D77|weihai|wh","\u68A7\u5DDE|wuzhou|wz","\u6587\u5C71|wenshan|ws","\u65E0\u9521|wuxi|wx","\u6F4D\u574A|weifang|wf","\u6B66\u5937\u5C71|wuyishan|wys","\u4E4C\u5170\u6D69\u7279|wulanhaote|wlht","\u6E29\u5DDE|wenzhou|wz","\u4E4C\u9C81\u6728\u9F50|wulumuqi|wlmq","\u4E07\u5DDE|wanzhou|wz","\u4E4C\u6D77|wuhai|wh","\u5174\u4E49|xingyi|xy","\u897F\u660C|xichang|xc","\u8944\u6A0A|xiangfan|xf","\u897F\u5B81|xining|xn","\u9521\u6797\u6D69\u7279|xilinhaote|xlht","\u897F\u53CC\u7248\u7EB3|xishuangbanna|xsbn","\u5F90\u5DDE|xuzhou|xz","\u4E49\u4E4C|yiwu|yw","\u6C38\u5DDE|yongzhou|yz","\u6986\u6797|yulin|yl","\u5EF6\u5B89|yanan|ya","\u8FD0\u57CE|yuncheng|yc","\u70DF\u53F0|yantai|yt","\u94F6\u5DDD|yinchuan|yc","\u5B9C\u660C|yichang|yc","\u5B9C\u5BBE|yibin|yb","\u76D0\u57CE|yancheng|yc","\u5EF6\u5409|yanji|yj","\u7389\u6811|yushu|ys","\u4F0A\u5B81|yining|yn","\u73E0\u6D77|zhuhai|zh","\u662D\u901A|zhaotong|zt","\u5F20\u5BB6\u754C|zhangjiajie|zjj","\u821F\u5C71|zhoushan|zs","\u90D1\u5DDE|zhengzhou|zz","\u4E2D\u536B|zhongwei|zw","\u82B7\u6C5F|zhijiang|zj","\u6E5B\u6C5F|zhanjiang|zj"],c=/^([\u4E00-\u9FA5\uf900-\ufa2d]+)\|(\w+)\|(\w)\w*$/i,d=/([\u4E00-\u9FA5\uf900-\ufa2d]+)/,e=/^[a-h]$/i,f=/^[i-p]/i,g=/^[q-z]/i,h={hot:{},ABCDEFGH:{},IJKLMNOP:{},QRSTUVWXYZ:{}};(function(){for(var a=0,d=b.length;a<d;a++){var j,k=c.exec(b[a]),l=k[1],m=k[2],n=k[3],o=m[0].toUpperCase();e.test(o)?j="ABCDEFGH":f.test(o)?j="IJKLMNOP":g.test(o)&&(j="QRSTUVWXYZ"),h[j][o]?h[j][o].push(l):(h[j][o]=[],h[j][o].push(l)),16>a&&(h.hot.hot?h.hot.hot.push(k[1]):(h.hot.hot=[],h.hot.hot.push(k[1])))}})();var i=function(a){this.target=a,this.container=null,this.resultct=null,this.isKeyslect=!1,this.isContainerExit=!1};i.prototype={constructor:i,init:function(){this.creatItem(),this.tabChange(),this.citySelect(),this.inputSearch(),this.keySelect(),this.stopPropagation()},creatItem:function(){if(!this.isContainerExit){for(var b in a("body").append("<div class=\"kucity\"><div class=\"citybox\"><h3 class=\"kucity_header\">\u70ED\u95E8\u57CE\u5E02(\u652F\u6301\u6C49\u5B57/\u62FC\u97F3\u641C\u7D22)</h3><ul class=\"kucity_nav\"><li class=\"active\">\u70ED\u95E8\u57CE\u5E02</li><li>ABCDEFGH</li><li>IJKLMNOP</li><li>QRSTUVWXYZ</li></ul><div class=\"kucity_body\"></div></div><ul class=\"result\"></ul></div>"),this.container=a(".kucity"),this.resultct=a(".result"),h){var c=[];for(var d in h[b])c.push(d);c.sort();var e=a("<div class=\"kucity_item\">");e.addClass(b);for(var f=0,g=c.length;f<g;f++){for(var k=a("<dl>"),l="<dt>"+("hot"==c[f]?"":c[f])+"</dt>",m=a("<dd>"),n="",o=0,p=h[b][c[f]].length;o<p;o++)n+="<span>"+h[b][c[f]][o]+"</span>";m.append(n),k.append(l).append(m),e.append(k)}a(".kucity_body").append(e),this.container.find(".hot").addClass("active")}this.isContainerExit=!0}},creatResult:function(a,b){var c=a.result,d=c.length,e="";if(!!d){for(var f=0;f<d;f++)e+="<li><span class=\"name\">"+c[f].cityName+"</span><span class=\"letter\">"+c[f].py+"</span></li>";this.container.find(".result").html("").html(e).find("li").eq(0).addClass("active")}else this.container.find(".result").html("<li>\u6CA1\u6709\u627E\u5230<span class=\"noresult\">"+b+"</span>\u76F8\u5173\u4FE1\u606F</li>")},tabChange:function(){a(".kucity_nav").on("click","li",function(b){var c=a(b.target),d=c.index();c.addClass("active").siblings().removeClass("active"),a(".kucity_item").eq(d).addClass("active").siblings().removeClass("active"),a(" .kucity_body").scrollTop(0)})},citySelect:function(){var b=this;a(".kucity_item dd").on("click","span",function(c){b.target.val(a(c.target).text()),b.container.hide()})},keySelect:function(){var a=this;this.target.on("keydown",function(b){var c=a.resultct.find(".active").index();if(-1!==c){function d(b){var d=a.resultct.find("li").length-1;c=b?c==d?0:c+1:0==c?d:c-1,a.resultct.find("li").eq(c).addClass("active").siblings().removeClass("active"),a.isKeyslect=!0}switch(b.keyCode){case 38:d(!1);break;case 40:d(!0);break;case 13:a.isKeyslect=!1,a.target.val(a.resultct.find(".active .name").text()),a.triggleShow("all"),a.target.blur();break;default:a.isKeyslect=!1;}}})},inputSearch:function(){function b(){c.container;c.triggleShow(!1);var b=a(this).val();if(b){a.ajax({url:"https://sjipiao.alitrip.com/city_search.do?_ksTS=1439362066383_11337&lines=10&_input_charset=utf-8&needProvince=true&q="+b,type:"get",dataType:"jsonp"}).done(function(a){c.creatResult(a,b)})}else c.triggleShow(!0)}var c=this;this.target.on("keyup",function(){c.isKeyslect||c.throttle(b,this)})},triggleShow:function(a){var b=this.container;"all"===a?b.hide():a?b.find(".citybox").show().end().find(".result").hide():b.find(".citybox").hide().end().find(".result").show()},throttle:function(a,b){clearTimeout(a.tId),a.tId=setTimeout(function(){a.call(b)},100)},stopPropagation:function(){function b(a){a.stopPropagation()}var c=this;this.container.on("click",b),this.target.on("click",b),a(document).on("click",function(){c.container.hide()})}};var j=null;a.fn.kuCity=function(){var b=a(this);return b.on("focus",function(c){var d=a(this).offset().top+a(this).outerHeight(),e=a(this).offset().left;j=j?j:new i(b),j.target=a(c.target),j.init(),j.container.show().offset({top:d+7,left:e}),j.triggleShow(!0),j.resultct.on("click","li",function(){j.target.val(a(this).find(".name").text()),j.triggleShow("all")})}),this}})(jQuery);